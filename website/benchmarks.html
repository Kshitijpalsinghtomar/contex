<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmarks — Contex</title>
    <meta name="description" content="Contex benchmarks — verified token reduction results.">
    <link rel="stylesheet" href="./style.css">
    <script>
        const theme = localStorage.getItem('contex-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
    </script>
</head>

<body>

    <nav class="nav">
        <a href="/" class="nav-brand">
            <div class="logo-icon">C</div>
            Contex
        </a>
        <ul class="nav-links">
            <li><a href="./">Home</a></li>
            <li><a href="./docs.html">Docs</a></li>
            <li><a href="./tens-text.html">TENS-Text</a></li>
            <li><a href="./benchmarks.html" class="active">Benchmarks</a></li>
            <li><a href="./playground.html">Playground</a></li>
            <li><a href="./vision.html">Vision</a></li>
            <li><a href="./dashboard.html">Dashboard</a></li>
        </ul>
        <div class="nav-actions">
            <button class="btn btn-ghost btn-sm" id="theme-toggle" aria-label="Toggle theme">
                <svg class="sun-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <a href="https://github.com/kshitijpalsinghtomar/contex" class="btn btn-ghost btn-sm" target="_blank">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                    <path
                        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                    </path>
                </svg>
                GitHub
            </a>
        </div>
    </nav>

    <div class="bench-page">
        <h1>Contex Benchmarks</h1>
        <p>Verified token reduction results from real test data across 15 dataset types, 5 output formats, and multiple row-counts.</p>

        <!-- Key Takeaways -->
        <div class="takeaways-box">
          <h3>Key Takeaways</h3>
          <ul>
            <li><strong>43% average pipeline savings</strong> — measured end-to-end including encoding overhead and header bytes.</li>
            <li><strong>94% peak format savings</strong> — deeply nested JSON benefits most from deep flattening and dictionary compression.</li>
            <li><strong>Zero data loss</strong> — 20/20 fidelity tests confirm lossless roundtrip across all formats and dataset types.</li>
            <li><strong>Sub-millisecond latency</strong> — encoding adds 1.6–42 μs/row depending on nesting depth; negligible vs API latency.</li>
            <li><strong>Deterministic output</strong> — same input always produces identical tokens, maximizing prefix cache hit rates.</li>
          </ul>
        </div>

        <!-- Verified Results -->
        <div class="bench-cards">
            <div class="bench-card">
                <div class="value blue">43%</div>
                <div class="label">Avg Pipeline Savings</div>
            </div>
            <div class="bench-card">
                <div class="value green">94%</div>
                <div class="label">Best Format Savings</div>
            </div>
            <div class="bench-card">
                <div class="value purple">600+</div>
                <div class="label">Tests Passing</div>
            </div>
            <div class="bench-card">
                <div class="value amber">36/36</div>
                <div class="label">Benchmark Tests Pass</div>
            </div>
            <div class="bench-card">
                <div class="value red">20/20</div>
                <div class="label">Data Fidelity</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="bench-section">
            <h2>Performance Visualization</h2>
            <div class="chart-container" style="position: relative; height:400px; width:100%; margin-bottom: 40px;">
                <canvas id="reductionChart"></canvas>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const ctx = document.getElementById('reductionChart').getContext('2d');

                // Data from Benchmark v7 — format-level savings across dataset types
                const data = {
                    labels: ['RealWorld/500', 'DeepNested/100', 'Flat/500', 'Nested/500', 'Repetitive/500'],
                    datasets: [
                        {
                            label: 'JSON Tokens',
                            data: [100, 100, 100, 100, 100],
                            backgroundColor: 'rgba(239, 68, 68, 0.6)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Contex Compact',
                            data: [32, 6, 55, 40, 30],
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }
                    ]
                };

                const config = {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary')
                                }
                            },
                            title: {
                                display: true,
                                text: 'Token Consumption: JSON vs Contex Compact (Lower is Better, Normalized %)',
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary')
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Token Count',
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted')
                                },
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--border-subtle')
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
                                }
                            }
                        }
                    }
                };

                const myChart = new Chart(ctx, config);

                // Update chart on theme change
                const observer = new MutationObserver(function (mutations) {
                    mutations.forEach(function (mutation) {
                        if (mutation.type === "attributes" && mutation.attributeName === "data-theme") {
                            myChart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                            myChart.options.plugins.title.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                            myChart.options.scales.y.title.color = getComputedStyle(document.documentElement).getPropertyValue('--text-muted');
                            myChart.options.scales.y.grid.color = getComputedStyle(document.documentElement).getPropertyValue('--border-subtle');
                            myChart.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                            myChart.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
                            myChart.update();
                        }
                    });
                });

                observer.observe(document.documentElement, {
                    attributes: true //configure it to listen to attribute changes
                });
            });
        </script>

        <!-- Token Reduction Table -->
        <div class="bench-section">
            <h2>Format Savings by Dataset (Benchmark v7)</h2>
            <p>Results across 15 dataset types, each tested at multiple sizes (10–1000 rows).</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Dataset</th>
                            <th>Format</th>
                            <th>Format Savings</th>
                            <th>Pipeline Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="highlight">
                            <td><strong>DeepNested/100</strong></td>
                            <td>Contex Compact</td>
                            <td class="saving">94%</td>
                            <td class="saving">88%</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>RealWorld/500</strong></td>
                            <td>Contex Compact</td>
                            <td class="saving">68%</td>
                            <td class="saving">52%</td>
                        </tr>
                        <tr>
                            <td>Flat/500</td>
                            <td>Contex Compact</td>
                            <td class="saving">45%</td>
                            <td class="saving">35%</td>
                        </tr>
                        <tr>
                            <td>Nested/500</td>
                            <td>Contex Compact</td>
                            <td class="saving">60%</td>
                            <td class="saving">48%</td>
                        </tr>
                        <tr>
                            <td>Repetitive/500</td>
                            <td>Contex Compact</td>
                            <td class="saving">70%</td>
                            <td class="saving">55%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Format Comparison -->
        <div class="bench-section">
            <h2>Format Ranking (RealWorld/500)</h2>
            <p>All output formats compared on production-like customer support ticket data.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Format</th>
                            <th>Savings vs JSON</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="highlight">
                            <td><strong>Contex Compact</strong></td>
                            <td class="saving">-68%</td>
                            <td>Dictionary compression + deep flattening</td>
                        </tr>
                        <tr>
                            <td>TOON</td>
                            <td class="saving">-56%</td>
                            <td>Tab-separated, no compression</td>
                        </tr>
                        <tr>
                            <td>CSV</td>
                            <td class="saving">-54%</td>
                            <td>Comma-separated values</td>
                        </tr>
                        <tr>
                            <td>TENS-Text</td>
                            <td class="saving">-43%</td>
                            <td>Human-readable debug/inspection format</td>
                        </tr>
                        <tr>
                            <td>Markdown</td>
                            <td class="saving">-38%</td>
                            <td>Pipe-separated tables</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Latency -->
        <div class="bench-section">
            <h2>Encoding Latency (Local Benchmark)</h2>
            <p>Contex adds negligible overhead — format encoding is measured in microseconds per row.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Dataset</th>
                            <th>Rows</th>
                            <th>Latency (μs/row)</th>
                            <th>Verdict</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Flat</td>
                            <td class="mono">500</td>
                            <td class="mono">1.6</td>
                            <td class="saving">Instant</td>
                        </tr>
                        <tr>
                            <td>RealWorld</td>
                            <td class="mono">500</td>
                            <td class="mono">8.2</td>
                            <td class="saving">Fast</td>
                        </tr>
                        <tr>
                            <td>DeepNested</td>
                            <td class="mono">100</td>
                            <td class="mono">42</td>
                            <td class="saving">Fast</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cost Savings -->
        <div class="bench-section">
            <h2>Annual Cost Savings (Projected)</h2>
            <p>Based on 10 million requests/month with 10K token context, using 43% avg savings.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Provider</th>
                            <th>Cost/1M tokens</th>
                            <th>Annual Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>OpenAI (gpt-4o)</td>
                            <td class="mono">$2.50</td>
                            <td class="saving">$154,800/year</td>
                        </tr>
                        <tr>
                            <td>Claude Sonnet 4</td>
                            <td class="mono">$3.00</td>
                            <td class="saving">$185,760/year</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.5 Flash</td>
                            <td class="mono">$0.30</td>
                            <td class="saving">$18,576/year</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Data Fidelity -->
        <div class="bench-section">
            <h2>Data Fidelity (Benchmark v7)</h2>
            <p>Every dataset's output is verified for perfect roundtrip accuracy.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Test Category</th>
                            <th>Result</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Data Fidelity</td>
                            <td class="saving">20/20 PASS</td>
                            <td>All formats preserve data integrity</td>
                        </tr>
                        <tr>
                            <td>Connectivity</td>
                            <td class="saving">16/16 PASS</td>
                            <td>Pipeline end-to-end verification</td>
                        </tr>
                        <tr>
                            <td>Total Benchmark</td>
                            <td class="saving">36/36 PASS</td>
                            <td>All benchmark tests passing</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- When Contex Wins Most -->
        <div class="bench-section">
            <h2>When Contex Wins Most</h2>
            <p>Not all data compresses equally. Here's where Contex delivers the highest ROI.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Data Pattern</th>
                            <th>Savings Tier</th>
                            <th>Why</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="highlight">
                            <td><strong>Deeply nested JSON</strong></td>
                            <td class="saving">80–94%</td>
                            <td>Deep flattening eliminates all structural tokens</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Repetitive values</strong></td>
                            <td class="saving">55–70%</td>
                            <td>Dictionary encoding replaces repeated strings with @0, @1</td>
                        </tr>
                        <tr>
                            <td>API responses</td>
                            <td class="saving">50–65%</td>
                            <td>Repeated status, date, and enum fields compress heavily</td>
                        </tr>
                        <tr>
                            <td>Flat tabular data</td>
                            <td class="saving">35–45%</td>
                            <td>Schema deduplication + boolean/null abbreviation</td>
                        </tr>
                        <tr>
                            <td>Unique text data</td>
                            <td>15–25%</td>
                            <td>Minimal dictionary opportunity; format savings only</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Edge-Case Robustness -->
        <div class="bench-section">
            <h2>Edge-Case Robustness</h2>
            <p>47 dedicated edge-case tests verify correct behavior on adversarial and unusual inputs.</p>

            <div style="overflow-x: auto;">
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Tests</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Unicode (CJK, emoji, RTL, ZWJ sequences)</td>
                            <td class="mono">8</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Sparse data (mostly null rows)</td>
                            <td class="mono">6</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Deep nesting (5+ levels)</td>
                            <td class="mono">5</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Special values (Infinity, NaN, empty strings)</td>
                            <td class="mono">7</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Mixed types &amp; heterogeneous arrays</td>
                            <td class="mono">6</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Directive name collisions</td>
                            <td class="mono">5</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Large payloads (10K+ rows)</td>
                            <td class="mono">4</td>
                            <td class="saving">PASS</td>
                        </tr>
                        <tr>
                            <td>Crash safety (invalid inputs)</td>
                            <td class="mono">6</td>
                            <td class="saving">PASS</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Methodology -->
        <div class="bench-section">
            <h2>Methodology</h2>
            <p>Benchmarks are run using the v7 benchmark suite covering 15 dataset types.</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
              <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px;">
                <h4 style="margin-bottom: 10px;">Datasets</h4>
                <p style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">Flat, Nested, DeepNested, Sparse, Repetitive, RealWorld, Wide, Narrow, Mixed, LargeValues, Unicode, ManyColumns, Boolean, IDs, Timestamps</p>
              </div>
              <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px;">
                <h4 style="margin-bottom: 10px;">Row Sizes</h4>
                <p style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">10, 50, 100, 500, and 1000 rows per dataset type. Each combination run independently to measure scaling characteristics.</p>
              </div>
              <div style="background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px;">
                <h4 style="margin-bottom: 10px;">Output Formats</h4>
                <p style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">Contex Compact, TOON, CSV, Markdown, TENS-Text. All tested for both token count and data fidelity.</p>
              </div>
            </div>

            <pre style="margin-top: 20px;"># Run the full benchmark suite
npx tsx packages/cli/src/benchmark.ts

# Analyze a specific dataset
contex analyze data.json --model gpt-4o-mini</pre>
        </div>

        <!-- Full Report Link -->
        <div class="bench-section" style="text-align: center; margin-top: 40px;">
            <h2>Want more details?</h2>
            <p>Explore the interactive benchmark report with filtering and raw data.</p>
            <a href="./report.html" class="btn btn-primary">View Full Report</a>
        </div>

    </div>

    <footer class="footer">
        <p>MIT © <a href="https://github.com/kshitijpalsinghtomar/contex">Contex</a> · Built for production LLM
            pipelines</p>
    </footer>

    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        const sunIcon = toggleBtn.querySelector('.sun-icon');
        const moonIcon = toggleBtn.querySelector('.moon-icon');

        function updateIcon() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            sunIcon.style.display = isDark ? 'none' : 'block';
            moonIcon.style.display = isDark ? 'block' : 'none';
            toggleBtn.style.color = isDark ? 'var(--text-muted)' : 'var(--accent-amber)';
        }
        updateIcon();

        toggleBtn.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('contex-theme', next);
            updateIcon();
        });
    </script>
</body>

</html>